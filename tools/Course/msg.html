	<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no" />
	<meta charset="utf-8">
	<meta name="format-detection" content="telephone=no,email=no,adress=no">

	<!--公共样式-->
	<link rel="stylesheet" type="text/css" href="../Css/bootstrap.css" />
	<link rel="stylesheet" type="text/css" href="../Css/bootstrap-responsive.css" />
	<link rel="stylesheet" type="text/css" href="../Css/style.css" />

	<!--日历样式-->
	<link rel="stylesheet" href="../assets/css/reset.css" />
	<link rel="stylesheet" type="text/css" href="../assets/css/simple-calendar.css">
	<link rel="stylesheet" href="../assets/css/calendar.css" />

	<title>课表列表</title>
	<style>
		#test {
			width: 100%;
			height: 100%;
			background-color: #000;
			position: absolute;
			top: 0;
			left: 0;
			z-index: 2;
			opacity: 0.3;
			/*兼容IE8及以下版本浏览器*/
			filter: alpha(opacity=30);
			display: none;
		}

		#detail_div{
			width: 800px;
			height: 550px;
			padding-bottom: 50px;
			background-color: white;
			margin: auto;
			position: absolute;
			z-index: 3;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			display: none;
			overflow-y: scroll;
			/*border: 2px solid #b1d6e8;*/
		}
		#test1 {
			width: 100%;
			height: 100%;
			background-color: #000;
			position: absolute;
			top: 0;
			left: 0;
			z-index: 2;
			opacity: 0.3;
			/*兼容IE8及以下版本浏览器*/
			filter: alpha(opacity=30);
			display: none;
		}
		.theadColor td,
		.tableleft {
			/*background-color: #b1d6e8;*/
			/*color: #1976b0;*/
			/*font-weight:normal;*/
		}
		.theadColor td,.tableleft  span {
			color:#000;
			font-weight: bold;
		}
		.day-l{
			float: left;
		}
		.day-r{
			float: right;
		}
		.table_radio tr td{
			border: 0;
		}
		.table_radio tr td input{
			margin: 0;
		}

	</style>
	<script type="text/javascript" src="../Js/jquery.js"></script>
	<script type="text/javascript" src="../Js/simple-calendar.js"></script>
	<script type="text/javascript" src="../Js/hammer-2.0.8-min.js"></script>
	<script type="text/javascript" src="../Js/js/laydate.js"></script>
	<script type="text/javascript" src="../Js/ui.js"></script>
	<script type="text/javascript" src="../Js/ursl.js"></script>
	<script type="text/javascript">
        var subpath="Course";
        var url1=urls;
        var n=0;
        var course=JSON.parse(window.sessionStorage? sessionStorage.getItem("course"): Cookie.read("course"));
        var detailjson={};
        //所有教练
        var allcoach=[];
        //关联公开课教练
        var coursecoach=[];
        var myCalendar="";
        var localhost = " ";
        var ifmatching=0;
        var weeks=[{"0":"周日"},{"1":"周一"},{"2":"周二"},{"3":"周三"},{"4":"周四"},{"5":"周五"},{"6":"周六"}];
        localhost = window.sessionStorage ? sessionStorage.getItem("lh") : Cookie.read("lh");
        //公开课详情
        function initcoursedetail(){
            var obj=new Object();
            obj.cid=course.id;
            obj.page=1;
            obj.count=99999;
            var datajson=JSON.stringify(obj);
            return $.ajax({
                type: "post",
                contentType:"application/x-www-form-urlencoded",
                data:datajson,
                dataType:"json",
                url:"http://" + url1 + ":6078/backstagegetcoursedetail",
                success: function(data) {
                    detailjson={};
                    if(data.respVo.resultCode=="0"){
                        for(var i=0;i<data.coursedetailmap.length;i++){
                            var timer=new Date(data.coursedetailmap[i].starttime);
                            timer=timer.getFullYear()+'/'+(timer.getMonth()+1)+'/'+timer.getDate();
                           // console.log(typeof(timer));
                            //var date=new Date(timer).getTime();
                            n=0;
                            for(var key in Object.keys(detailjson)) {
                                if (Object.keys(detailjson)[key] == timer) {
                                    detailjson[timer].push(data.coursedetailmap[i]);
                                    n=1;
                                }
                            }
                            if(n==0) {
                                detailjson[timer] = [];
                                detailjson[timer].push(data.coursedetailmap[i]);
                            }

                        }
                        riqi();
						//console.log(detailjson);
                    }else{
                        riqi();
                    }


                },
                error: function(err) {
//						alert("err:" + err);
                }
            });
        }
        //初始化调用
        function init(){
            initcoursedetail();
            initallcoach();
            initcoursecoach();
        }

        //新增用户
        function add1(id) {
            var s = document.getElementById("test");
            s.style.display = "block";
            var l = document.getElementById("detail_div");
            l.style.display = "block";
            var detail_table = document.getElementById('detail_table');
            while (detail_table.rows.length > 0) {
                detail_table.deleteRow(0);
            }
            initTables(1);
            var select = document.getElementById("coachtext");
            while (select.options.length > 0) {
                select.remove(0);
            }
            console.log(allcoach);
            select.options.add(new Option(course.coachname+"-"+course.coachnickname,course.coach));
            for (var all of allcoach) {
                if(course.coach!==all.coach){
                    select.options.add(new Option(all.coachname+"-"+all.coachnickname, all.coach));
				}

            }
            var optrow = detail_table.insertRow(detail_table.rows.length);
            optrow.innerHTML = `<tr>
										<td class="tableleft"></td>
										<td colspan="3">
											<a  onclick="onSavebtnClickHandler(1)" class="save">保 存</a>
										</td>
								</tr>`;
        }

        //批量新增用户
        function add2(id) {
            var s = document.getElementById("test");
            s.style.display = "block";
            var l = document.getElementById("detail_div");
            l.style.display = "block";
            initTables(2);
            var select1 = document.getElementById("coachtext");
            while (select1.options.length > 0) {
                select1.remove(0);
            }
            select1.options.add(new Option(course.coachname+"-"+course.coachnickname,course.coach));
            for (var all of allcoach) {
                if(course.coach!==all.coach){
                    select1.options.add(new Option(all.coachname+"-"+all.coachnickname, all.coach));
                }

            }


            var optrow = detail_table.insertRow(detail_table.rows.length);
            optrow.innerHTML = `<tr>
										<td class="tableleft"></td>
										<td colspan="3">
											<a  onclick="onSavebtnClickHandler(2)" class="save">保 存</a>
										</td>
								</tr>`;
        }

        //公共列表
        function initTables(idx){
            var detail_table = document.getElementById('detail_table');
            while (detail_table.rows.length > 0) {
                detail_table.deleteRow(0);
            }
            //console.log(course);
            var row0 = detail_table.insertRow(0);
            row0.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">课程</span></td><td style="padding-top: 18px">
							<input type="text" id="cidtext" class="txt" name="moduletitle" style="border-radius: 0px;width: 95%" value="${course.name}" readonly="readonly" /><br />
							<span id="cidtext_info"></span>
							</td>`;

            if(idx==1) {
                var row1 = detail_table.insertRow(1);
                row1.innerHTML = `<td class="tableleft"><span class="tanKuangSpan">课时名称</span></td><td style="padding-top: 18px">
							<input type="text" id="nametext" class="txt" name="moduletitle" style="border-radius: 0px;width: 95%" value="" /><br />
							<span id="nametext_info"></span>
							</td>`;
            }else if(idx==2){
                var row1 = detail_table.insertRow(1);
                row1.innerHTML = `<td class="tableleft"><span class="tanKuangSpan">课时名称</span></td><td style="padding-top: 18px">
                			<div style="width: 95%; margin: 0 auto; overflow: hidden">
								<div class="fl" style="width: 80%"><input type="text" id="nametext" class="txt" name="moduletitle" style="border-radius: 0px; width: 100%" value="" /></div>
								<div class="fl" style="width: 20%"><input type="checkbox" id="increase" >递增</div>
                			</div>
							<span id="nametext_info"></span>
							</td>`;
            }


            var row2 = detail_table.insertRow(2);
            row2.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">课时序号</span></td><td style="padding-top: 18px">
							<input type="text" id="classhourtext" class="txt" name="moduletitle" style="border-radius: 0px;width: 95%" value="" /><br />
							<span id="classhourtext_info"></span>
							</td>`;

            var row3 = detail_table.insertRow(3);
            row3.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">教学计划</span></td><td style="padding-top: 18px">
							<input type="text" id="descriptiontext" class="txt" name="moduletitle" style="border-radius: 0px;width: 95%" value="" /><br />
							<span id="descriptiontext_info"></span>
							</td>`;
            var row4 = detail_table.insertRow(4);
            row4.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">教练</span></td><td style="padding-top: 18px">
							<select name="" id="coachtext" style="border-radius: 0px;width: 95%" onchange="checkcoachtext()" ></select><br />
							<span id="coachtext_info"></span>
							</td>`;
            var row5 = detail_table.insertRow(5);
            row5.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">状态</span></td><td style="padding-top: 18px">
							<input type="text" id="statetext" class="txt" name="moduletitle" style="border-radius: 0px;width: 95%" value="0" /><br />
							<span id="statetext_info"></span>
							</td>`;
            row5.style.display="none";

            if(idx==1){
                var row6 = detail_table.insertRow(6);
                row6.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">上课日期</span></td><td style="padding-top: 18px">
								<input type="text" id="onlydaytext" class="timer1" name="moduletitle" style="border-radius: 0px;width: 95%" value="" /><br />
								<span id="onlydaytext_info"></span>
								</td>`;
                laydate.render({
                    elem: '#onlydaytext',
                    min: timestampToDate(course.starttime),
                    max: timestampToDate(course.endtime),
                    trigger: 'click'
                });
                var row7 = detail_table.insertRow(7);
                var row8 = detail_table.insertRow(8);
                var row9 = detail_table.insertRow(9);
                var row10 = detail_table.insertRow(10);
            }else{

                var row6 = detail_table.insertRow(6);
                row6.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">类型</span></td><td>
								<table class="table_radio">
									<tr>
									<td><input  type="radio" name="typetext" value="1" checked="checked"/> 每天</td>
									<td><input  type="radio" name="typetext" value="2"/> 每周</td>
									<td><input  type="radio" name="typetext" value="3"/> 每月</td>
									</tr>
								</table>
								<span id="typetext_info"></span>
								</td>`;

                $(":radio").click(function(){
                    $(this).parent().siblings().children().removeAttr("checked");
                    $(this).attr("checked","checked");
                    if($(this).val()==2){
						$("#week").css("display","table-row");
					}else{
                        $("#week").css("display","none");
					}
                    if($(this).val()==3){
                        $("#day").css("display","none");
                        $("#month").css("display","table-row");
                        $("#ri").css("display","table-row");

                    }else{
                        $("#day").css("display","table-row");
                        $("#month").css("display","none");
                        $("#ri").css("display","none");

                    }
                });

                var row7 = detail_table.insertRow(7);
                row7.setAttribute("id","day");
                row7.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">上课日期—下课日期</span></td><td style="padding-top: 18px">
							<input type="text" id="startdaytext" class="timer2" name="moduletitle" style="border-radius: 0px;width: 45%"  />—
							<input type="text" id="enddaytext" class="timer2" name="moduletitle" style="border-radius: 0px;width: 45%" /><br />
							<span id="daytxt_info"></span>
							</td>`;

						lay('.timer2').each(function(){
							laydate.render({
								elem: this,
								min: timestampToDate(course.starttime),
								max: timestampToDate(course.endtime),
								trigger: 'click'
							});
						});
                var row8 = detail_table.insertRow(8);
                row8.setAttribute("id","month");
                $("#month").css("display","none");
                row8.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">上课日期—下课日期</span></td><td style="padding-top: 18px">
							<input type="text" id="startmonthtext" class="timer3" name="moduletitle" style="border-radius: 0px;width: 45%"  />—
							<input type="text" id="endmonthtext" class="timer3" name="moduletitle" style="border-radius: 0px;width: 45%" /><br />
							<span id="monthtxt_info"></span>
							</td>`;
						lay('.timer3').each(function(){
							laydate.render({
								elem: this,
                                type: 'month',
								min: timestampToDate(course.starttime),
								trigger: 'click'
							});
						});

                var row9 = detail_table.insertRow(9);
                row9.setAttribute("id","week");
                $("#week").css("display","none");
				row9.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">周</span></td>
								<td>
									<table class="table_radio">
										<tr>
										<td><input  type="checkbox" name="weektext" value="0" checked="checked"/>周日</td>
										<td><input  type="checkbox" name="weektext" value="1" />周一</td>
										<td><input  type="checkbox" name="weektext" value="2" />周二</td>
										<td><input  type="checkbox" name="weektext" value="3" />周三</td>
										<td><input  type="checkbox" name="weektext" value="4" />周四</td>
										<td><input  type="checkbox" name="weektext" value="5" />周五</td>
										<td><input  type="checkbox" name="weektext" value="6" />周六</td>
										</tr>
									</table>
									<span id="weektext_info"></span>
								</td>`;



                var row10 = detail_table.insertRow(10);
                row10.setAttribute("id","ri");
                $("#ri").css("display","none");
                row10.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">日</span></td><td style="padding-top: 18px">
						<select name="" id="daytext" style="border-radius: 0px;width: 95%" ></select><br/>
						<span id="daytext_info"></span>
						</td>`;

                var select3 = document.getElementById("daytext");
                while (select3.options.length > 0) {
                    select3.remove(0);
                }
				select3.options.add(new Option("请选择具体日",""));
				for (var d=1;d<32;d++) {
				    var dd;
				    if(d<10){
				        dd=0+""+d;
                        select3.options.add(new Option(d,dd));
					}else{
                        select3.options.add(new Option(d,d));
					}

				}

            }

            var row11 = detail_table.insertRow(11);
            row11.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">上课时间—下课时间</span></td><td style="padding-top: 18px">
							<input type="text" id="starttimetext" class="timer4" name="moduletitle" style="border-radius: 0px;width: 45%" value=""  />—
							<input type="text" id="endtimetext" class="timer4" name="moduletitle" style="border-radius: 0px;width: 45%" value="" /><br />
							<span id="timetxt_info"></span>
							</td>`;
            lay('.timer4').each(function(){
                laydate.render({
                    elem: this,
                    type: 'time',
                    min: '00:00:00',
                    max: '23:00:00',
                    format: 'HH:mm',
                    trigger: 'click'
                });
            });
            var row12 = detail_table.insertRow(12);
            row12.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">说明图片</span></td><td>
								<div style="width: 95%; margin: 0 auto;" ><input type="file" id="imgurltext" class="txt" name="moduletitle" style="border-radius: 0px; float: left"  /><div style="clear: both; height: 0px;"></div></div>
								<span id="imgurltext_info"></span>
							</td>`;
            var row13 = detail_table.insertRow(13);
            row13.innerHTML=`<td class="tableleft"><span class="tanKuangSpan">说明视频</span></td><td style="padding-top: 18px">
								<input type="text" id="weburltext" class="timer1" name="moduletitle" style="border-radius: 0px;width: 95%" value=""  placeholder="请输入说明视频链接"/><br />
								<span id="weburltext_info"></span>
							</td>`;
        }

        //图片上传
        function upload() {
            var formData = new FormData();
            formData.append("file", document.getElementById("imgurltext").files[0]);
            //console.log(document.getElementById("imgurltext").files[0]);
            $.ajax({
                url: "http://" + localhost + ":8080/taiji.tools/FileServlet?dir="+subpath,
                type: "POST",
                data: formData,
                contentType: false,
                processData: false,
                success: function(data) {
                },
                error: function() {
                    mizhu.alert('', '上传失败！','iconfont-close');
                }
            });
        }

        //保存添加与修改的用户
        function onSavebtnClickHandler(idx) {
            if(checknametext()&&checkclasshourtext()&&checkdescriptiontext()&&checkcoachtext()){
                var datajson;
                var url = "http://" + url1 + ":6078/backstageaddcoursedetail";
                var obj = new Object();
                obj.cid = course.id;
                obj.name = document.getElementById('nametext').value;
                obj.classhour = document.getElementById('classhourtext').value;
                obj.description = document.getElementById('descriptiontext').value;
                obj.coach = document.getElementById('coachtext').value;
                obj.state = document.getElementById('statetext').value;
                obj.weburl = document.getElementById('weburltext').value;
				//开始时间—结束时间
                var starttime = document.getElementById('starttimetext').value;
                var endtime = document.getElementById('endtimetext').value;

                if (idx==1 && checkonlydaytext() && checkstarttime() && checkendtime()&&checkimgurltext()) {
                    obj.imgurl = "/" + subpath + "/" + document.getElementById("imgurltext").files[0].name;
                    var startday = document.getElementById('onlydaytext').value;
                    obj.starttime = new Date(startday+" "+starttime).getTime();
                    obj.endtime = new Date(startday+" "+endtime).getTime();
                    var ado=new Object();
                    ado.cid=course.id;
                    ado.starttime=new Date(startday+" "+starttime).getTime();
                    ado.endtime=new Date(startday+" "+endtime).getTime();
                    var adojson= JSON.stringify(ado);
                    console.log(adojson);
                    $.ajax({
                        type: "post",
                        contentType:"application/x-www-form-urlencoded",
                        data:adojson,
                        dataType:"json",
                        url:"http://" + url1 + ":6078/backstagecheckcoursetime",
                        success: function (res) {
                            console.log(res);
                            if(res.respVo.resultCode==0){
                                datajson = JSON.stringify(obj);
                                //console.log(datajson);
                                save();
							}else{
                                mizhu.alert('', '上课时间与下课时间范围与现有的课时重复，请重新选择！','iconfont-close');
							}
                        },
                        error: function (err) {
                            //alert("err:" + err);
                        }
                    });


                }else if(idx==2){
                    var ifincrease=document.getElementById('increase').checked;
                    var types=document.getElementsByName('typetext');
                    var type;
                    for(var i=0;i<types.length;i++) {
                        if (types[i].checked) {
                            type = types[i].value;
                        }
                    }
					//console.log(type);
					if(type==1 && checkstartday() && checkendday() && checkstarttime() && checkendtime()&&checkimgurltext()){
                        obj.imgurl = "/" + subpath + "/" + document.getElementById("imgurltext").files[0].name;
                        var startday = document.getElementById('startdaytext').value;
                        var endday = document.getElementById('enddaytext').value;
                        var days=(new Date(endday).getTime()-new Date(startday).getTime())/(24*3600*1000)+1;
                        for(var i=0;i<days;i++){
                            if(ifincrease==true){
                                var n=i;
                                n++;
                                obj.name = document.getElementById('nametext').value+""+n;
                            }
                            obj.starttime=new Date(startday+" "+starttime).getTime()+i*24*3600*1000;
                            obj.endtime=new Date(startday+" "+endtime).getTime()+i*24*3600*1000;
                            datajson = JSON.stringify(obj);
                            //console.log(datajson);
                            save(i,days-1);
                        }


					}else if(type==2 && checkstartday() && checkendday() && checkweektext() && checkstarttime() && checkendtime()&&checkimgurltext()){
                        obj.imgurl = "/" + subpath + "/" + document.getElementById("imgurltext").files[0].name;
                        var startday = document.getElementById('startdaytext').value;
                        var endday = document.getElementById('enddaytext').value;
                        var days=(new Date(endday).getTime()-new Date(startday).getTime())/(24*3600*1000)+1;
                        var groupCheckbox=$("input[name='weektext']");
                        //统计被保存的次数
                        var countsave=0;
                        //统计上课、下课区间与勾选的周匹配的次数
                        var countchecked=0;
                        for(var i=0;i<days;i++){
                            var compare=new Date(startday).getTime()+i*24*3600*1000;
                            var weekCompare=new Date(compare).getDay();
							for(j=0;j<groupCheckbox.length;j++) {
								if(groupCheckbox[j].checked){
									var val =groupCheckbox[j].value;
									if(val==weekCompare) {
										countchecked++;
									}
								}
							}
                        }
                        console.log(days);
                        for(var i=0;i<days;i++){
                            var compare=new Date(startday).getTime()+i*24*3600*1000;
                            var weekCompare=new Date(compare).getDay();
                            console.log(weekCompare);
                            //var weekRefer=document.getElementById("weektext").value;
                            for(j=0;j<groupCheckbox.length;j++){
                                if(groupCheckbox[j].checked){
                                    var val =groupCheckbox[j].value;
                                    if(val==weekCompare){
                                        ifmatching++;
                                        countsave++;
                                        if(ifincrease==true){
                                            obj.name = document.getElementById('nametext').value+""+countsave;
                                        }
                                        obj.starttime=new Date(startday+" "+starttime).getTime()+i*24*3600*1000;
                                        obj.endtime=new Date(startday+" "+endtime).getTime()+i*24*3600*1000;
                                        datajson = JSON.stringify(obj);
                                        console.log(countsave+":"+countchecked);
                                       save(countsave,countchecked);
                                    }
                                }
                            }

                        }
                        if(ifmatching==0){
                            mizhu.alert('', '上课至下课日期不在所勾选的周范围内','iconfont-close');
                            return
                        }

					}else if(type==3 && checkstartmonth() && checkendmonth()&& checkdaytext() && checkstarttime() && checkendtime()&&checkimgurltext()){
                        obj.imgurl = "/" + subpath + "/" + document.getElementById("imgurltext").files[0].name;
                        var startmonth = document.getElementById('startmonthtext').value;
                        var endmonth = document.getElementById('endmonthtext').value;
                        var months=getIntervalMonth(new Date(startmonth),new Date(endmonth));
                        var startM=new Date(startmonth).getMonth()+1;
                        var startY=new Date(startmonth).getFullYear();
                        for(var i=0;i<months;i++){
                            if(ifincrease==true){
                                var n=i;
                                n++;
                                obj.name = document.getElementById('nametext').value+""+n;
                            }
                            if(startM<12){
                                startmonth=startY+"-"+(startM>9 ? startM : "0" + startM);
                                startM+=1;
							}else{
                                startmonth=startY+"-"+(startM>9 ? startM : "0" + startM);
                                startY+=1;
                                startM=1;
							}
							//console.log(startmonth);
                            var dayRefer=document.getElementById("daytext").value;
                            obj.starttime=new Date(startmonth+"-"+dayRefer+" "+starttime).getTime();
                            obj.endtime=new Date(startmonth+"-"+dayRefer+" "+endtime).getTime();
                            datajson = JSON.stringify(obj);
                            //console.log(datajson);
                            save(i,months-1);
						}
					}


                }else{
                    mizhu.alert('','请正确完善信息','iconfont-close');
                }
                function save(i=1,days=1){
                    $.ajax({
                        type: "post",
                        contentType: "application/x-www-form-urlencoded",
                        data: datajson,
                        dataType: "json",
                        url: url,
                        success: function (data) {
                            console.log(i+":"+days);
                            if(i==days){
                                //console.log(data);
                                //console.log(currentIndex);
                                if(data.respVo.resultCode<0){
                                    mizhu.alert('',data.respVo.resultDesc,'iconfont-close');
                                    return;
                                }else{
                                    upload();
                                    mizhu.alert('', '添加成功','iconfont-gou');
                                    init();
                                    cancel_shield();
                                }
							}

                        },
                        error: function (err) {
                            //mizhu.alert('','保存失败','iconfont-close');
                            cancel_shield();
                        }
                    });
                }
            }else{
                mizhu.alert('', '请正确完善信息','iconfont-close');
            }

        }

		//获取月份差
        function getIntervalMonth(startmonth,endmonth){
            var startMonth = startmonth.getMonth();
            var endMonth = endmonth.getMonth();
            var intervalMonth = (endmonth.getFullYear()*12+endMonth) - (startmonth.getFullYear()*12+startMonth)+1;
            return intervalMonth;
        }

        //关闭弹出的div
        function cancel_shield() {
            var s = document.getElementById("test");
            s.style.display = "none";
            var d = document.getElementById("detail_div");
            d.style.display = "none";
            var m = document.getElementById("mytooltip");
            m.style.display = "none";
        }
        //验证

        function checkclasshourtext(){
            var classhourtext = document.getElementById("classhourtext");
            var classhourtext_info = document.getElementById("classhourtext_info");
            if (classhourtext.value == "" ) {
                classhourtext_info.innerHTML = "该字段不能为空";
                classhourtext.style.border = "1px solid red";
                classhourtext_info.style.color = "red";
                return false;
            }
            else {

				classhourtext_info.innerHTML = "";
				classhourtext.style.border = "";
				return true;

            }

        }
        function checknametext(){
            var nametext = document.getElementById("nametext");
            var nametext_info = document.getElementById("nametext_info");
            if (nametext.value == "" ) {
                nametext_info.innerHTML = "该字段不能为空";
                nametext.style.border = "1px solid red";
                nametext_info.style.color = "red";
                return false;
            }
            else {
                nametext_info.innerHTML = "";
                nametext.style.border = "";
                return true;
            }

        }
        function checkdescriptiontext(){
            var descriptiontext = document.getElementById("descriptiontext");
            var descriptiontext_info = document.getElementById("descriptiontext_info");
            if (descriptiontext.value == "" ) {
                descriptiontext_info.innerHTML = "该字段不能为空";
                descriptiontext.style.border = "1px solid red";
                descriptiontext_info.style.color = "red";
                return false;
            }
            else {
                descriptiontext_info.innerHTML = "";
                descriptiontext.style.border = "";
                return true;
            }

        }
        function checkcoachtext(){
            var coachtext = document.getElementById("coachtext");
            var coachtext_info = document.getElementById("coachtext_info");
            if (coachtext.value == "" ) {
                coachtext_info.innerHTML = "该字段不能为空";
                coachtext.style.border = "1px solid red";
                coachtext_info.style.color = "red";
                return false;
            }
            else {
				coachtext_info.innerHTML = "";
				coachtext.style.border = "";
				return true;

            }

        }
        function checkonlydaytext(){
            var onlydaytext = document.getElementById("onlydaytext");
            var onlydaytext_info = document.getElementById("onlydaytext_info");
            if (onlydaytext.value == "" ) {
                onlydaytext_info.innerHTML = "该字段不能为空";
                onlydaytext.style.border = "1px solid red";
                onlydaytext_info.style.color = "red";
                return false;
            }
            else {
                onlydaytext_info.innerHTML = "";
                onlydaytext.style.border = "";
                return true;
            }
		}
        //开始天数
        function checkstartday() 	{
            var startdaytext = document.getElementById("startdaytext");
            var daytxt_info = document.getElementById("daytxt_info");
            if (startdaytext.value == "" ) {
                daytxt_info.innerHTML = "该字段不能为空";
                startdaytext.style.border = "1px solid red";
                daytxt_info.style.color = "red";
                return false;
            }
            else {
                daytxt_info.innerHTML = "";
                startdaytext.style.border = "";
                return true;
            }

        }
        //结束天数
        function checkendday() {
            var startdaytext = document.getElementById("startdaytext");
            var enddaytext = document.getElementById("enddaytext");
            var daytxt_info = document.getElementById("daytxt_info");
            var startday=new Date(startdaytext.value).getTime();
            var endday=new Date(enddaytext.value).getTime();
            if (enddaytext.value == "" ) {
                daytxt_info.innerHTML = "该字段不能为空";
                enddaytext.style.border = "1px solid red";
                daytxt_info.style.color = "red";
                return false;
            }
            else {
                if(endday<=startday){
                    daytxt_info.innerHTML = "请选择大于开始日期的结束日期";
                    enddaytext.style.border = "1px solid red";
                    daytxt_info.style.color = "red";
                    return false;
                }else{
                    daytxt_info.innerHTML = "";
                    enddaytext.style.border = "";
                    return true;
                }

            }
        }

        function checkweektext(){
            var groupCheckbox=$("input[name='weektext']");
            var weektext_info = document.getElementById("weektext_info");
            var ifweek=0;
            for(i=0;i<groupCheckbox.length;i++){
                if(groupCheckbox[i].checked){
                    ifweek++;
                }
            }
            if (ifweek == 0) {
                weektext_info.innerHTML = "该字段不能为空";
                weektext_info.style.color = "red";
                return false;
            }
            else {
                weektext_info.innerHTML = "";
                return true;
            }

        }

        function checkdaytext(){
            var daytext = document.getElementById("daytext");
            var daytext_info = document.getElementById("daytext_info");
            if (daytext.value == "" ) {
                daytext_info.innerHTML = "该字段不能为空";
                daytext.style.border = "1px solid red";
                daytext_info.style.color = "red";
                return false;
            }
            else {
                daytext_info.innerHTML = "";
                daytext.style.border = "";
                return true;
            }
        }
        //开始月份
        function checkstartmonth() 	{
            var startmonthtext = document.getElementById("startmonthtext");
            var monthtxt_info = document.getElementById("monthtxt_info");
            if (startmonthtext.value == "" ) {
                monthtxt_info.innerHTML = "该字段不能为空";
                startmonthtext.style.border = "1px solid red";
                monthtxt_info.style.color = "red";
                return false;
            }
            else {
                monthtxt_info.innerHTML = "";
                startmonthtext.style.border = "";
                return true;
            }

        }
        //结束月份
        function checkendmonth() {
            var startmonthtext = document.getElementById("startmonthtext");
            var endmonthtext = document.getElementById("endmonthtext");
            var monthtxt_info = document.getElementById("monthtxt_info");
            var startday=new Date(startmonthtext.value).getTime();
            var endday=new Date(endmonthtext.value).getTime();
            if (endmonthtext.value == "" ) {
                monthtxt_info.innerHTML = "该字段不能为空";
                endmonthtext.style.border = "1px solid red";
                monthtxt_info.style.color = "red";
                return false;
            }
            else {
                if(endday<=startday){
                    monthtxt_info.innerHTML = "请选择大于开始日期的结束日期";
                    endmonthtext.style.border = "1px solid red";
                    monthtxt_info.style.color = "red";
                    return false;
                }else{
                    monthtxt_info.innerHTML = "";
                    endmonthtext.style.border = "";
                    return true;
                }

            }
        }
        //开始时间
        function checkstarttime() {
            var starttimetext = document.getElementById("starttimetext");
            var timetxt_info = document.getElementById("timetxt_info");
            //var startime=new Date(starttimetext.value).getTime();
            if (starttimetext.value == "" ) {
                timetxt_info.innerHTML = "该字段不能为空";
                starttimetext.style.border = "1px solid red";
                timetxt_info.style.color = "red";
                return false;
            }
            else {
                //var LocaleDate=new Date(starttimetext.value).toLocaleDateString();
                //var star=new Date(LocaleDate).getTime()+8*3600*1000;
                //if(startime<star){
                   // timetxt_info.innerHTML = "请选择8点之后的时间";
                    //starttimetext.style.border = "1px solid red";
                    //timetxt_info.style.color = "red";
                //}else{
                    timetxt_info.innerHTML = "";
                    starttimetext.style.border = "";
                    return true;
               // }

            }

        }
        //结束时间
        function checkendtime() {
            var startdaytext = document.getElementById("startdaytext");
            var starttimetext = document.getElementById("starttimetext");
            var endtimetext = document.getElementById("endtimetext");
            var timetxt_info = document.getElementById("timetxt_info");
            var startime=new Date(timestampToDate("2018-04-25")+" "+starttimetext.value).getTime();
            var endtime=new Date(timestampToDate("2018-04-25")+" "+endtimetext.value).getTime();
            //console.log(onlydaytext.value+":"+starttimetext.value+":"+endtimetext.value);
            if (endtimetext.value == "" ) {
                timetxt_info.innerHTML = "该字段不能为空";
                endtimetext.style.border = "1px solid red";
                timetxt_info.style.color = "red";
                return false;
            }
            else {
//                var LocaleDate=new Date(endtimetext.value).toLocaleDateString();
//                var end=new Date(LocaleDate).getTime()+20*3600*1000;
//                console.log(endtime+":"+end);
                if(endtime<=startime){
                    timetxt_info.innerHTML = "请选择大于开始时间的结束时间";
                    endtimetext.style.border = "1px solid red";
                    timetxt_info.style.color = "red";
                    return false;
                }else{
                    timetxt_info.innerHTML = "";
                    endtimetext.style.border = "";
                    return true;
                }

            }
        }
        function checkimgurltext(){
            var imgurltext = document.getElementById("imgurltext");
            var imgurltext_info = document.getElementById("imgurltext_info");
            if (!imgurltext.files[0]) {
                imgurltext_info.innerHTML = "该字段不能为空";
                imgurltext_info.style.color = "red";
                return false;
            }else{
                imgurltext_info.innerHTML = "";
                imgurltext.style.border = "";
                return true;
            }
        }
        //日期
        function riqi(){
            myCalendar = new SimpleCalendar('#calendar');
            $(function(){
                var monthCH = $('.sc-select-month').text();
                $(".sc-mleft").click(function(e){
                    e.stopImmediatePropagation();
                    myCalendar.subMonth();
                    var year = $('.sc-select-year').text();
                    var monthCH = $('.sc-select-month').text();
                    var month = SimpleCalendar.prototype.languageData.months_CH.indexOf(monthCH)+1;
                });
                $(".sc-mright").click(function(e){
                    e.stopImmediatePropagation();
                    myCalendar.addMonth();
                    var year = $('.sc-select-year').text();
                    var monthCH = $('.sc-select-month').text();
                    var month = SimpleCalendar.prototype.languageData.months_CH.indexOf(monthCH)+1;
                })
            });

            //滑动切换
            var myElement = document.getElementById('calendar');
            var hammer = new Hammer(myElement);
            hammer.on("swipeleft", function (ev) {
                //console.log(3);
                myCalendar.addMonth();
            });
            hammer.on("swiperight", function (ev) {
                //console.log(4);
                myCalendar.subMonth();
            });

            //添加标记
            var mark = detailjson;
            //console.log(detailjson);
            myCalendar._defaultOptions.mark=mark;
            myCalendar.update();

            //有标记的日期点击事件
            $('#calendar').on("click", '.sc-selected', function() {
                // var announcement=document.getElementsByClassName("announcement")[0];
                // announcement.style.display="block";
                announceList($(this));
            });

            //显示选择日期当天的活动
            function announceList(v){
                var year = $('.sc-select-year').text();
                var monthCH = $('.sc-select-month').text();
                var day = v.children()[1].innerText;
                var month = SimpleCalendar.prototype.languageData.months_CH.indexOf(monthCH)+1;
                var date = year + '-' + month + '-' + day;
                window.location="detail.html";
                if (window.sessionStorage) {
                    sessionStorage.setItem("date", date);
                    sessionStorage.setItem("course", JSON.stringify(course));
                } else {
                    Cookie.write("date", date);
                    Cookie.write("course", JSON.stringify(course));

                }
            }
        }

        //获取所有教练
        function initallcoach(){
            //console.log(course);
            allcoach.push({"coach":course.coach,"coachname":course.coachname,"coachnickname":course.coachnickname});
            if(course.subcoachname){
                allcoach.push({"coach":course.subcoach,"coachname":course.subcoachname,"coachnickname":course.subcoachnickname});
			}

        }
        //获取关联公开课教练
        function initcoursecoach(){
            var obj=new Object();
            var datajson=JSON.stringify(obj);
            $.ajax({
                type: "post",
                contentType:"application/x-www-form-urlencoded",
                data:datajson,
                dataType:"json",
                url:"http://" + url1 + ":6078/backstagegetcoursecoach",
                success: function(data) {
                    //console.log(data);
                    coursecoach=[];
                    if(data.respVo.resultCode=="0"){
                        //console.log(data);
                        for(var i=0;i<data.usercoursecoachmap.length;i++){
                            coursecoach.push(data.usercoursecoachmap[i]);
                        }
                    }else{
                        coursecoach.length=0;
                    }


                },
                error: function(err) {
//						alert("err:" + err);
                }
            });
        }
        function back(){
            window.location ="index.html";
        }

        //转换时间戳
        function timestampToDate(timestamp) {
            var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
            Y = date.getFullYear() + '-';
            M = (date.getMonth()+1 < 10 ? '0'+(date.getMonth()+1) : date.getMonth()+1) + '-';
            D = date.getDate() + ' ';
            h = date.getHours() + ':';
            m = date.getMinutes() + ':';
            s = date.getSeconds();
            return Y+M+D;
        }
	</script>
</head>

<body onload="init()">
<div class="m10">
	<a id="addnew1"  onclick="add1()" class="add2">新  增</a>&nbsp;&nbsp;
	<a id="addnew2"  onclick="add2()" class="add2">批 量 新  增</a>&nbsp;&nbsp;
	<a  onclick="back()"  class="back">返 回</a>
</div>
<div class="inner m10">
	<div id='calendar' class="sc-calendar">
		<div class="sc-header">
			<div class="sc-title">
				<div class="year"><span class="sc-select-year" name=""></span>年</div>
				<div class="month">
					<div class="arrow sc-mleft"></div>
					<div class="monthdiv">
						<span class="sc-select-month" name=""></span>
					</div>
					<div class="arrow sc-mright"></div>
				</div>
			</div>
			<div class="sc-week"></div>
		</div>
		<div class="sc-body">
			<div class="sc-days"></div>
		</div>
	</div>
</div>
<!--//弹出遮罩-->
<div id="test"></div>

<!--公开课详细编辑-->
<div id="detail_div">
	<input type="image" src='../assets/img/guanbi.png' onclick="cancel_shield()" style="position: absolute;left: 745px;top: 10px;width: 27px;height: 27px">
	<table class="table table-bordered " style="width: 600px;margin:0 auto;margin-top: 60px" id="detail_table">
	</table>
</div>

<div id="mytooltip"></div>

<div id="test1"><span>数据同步中，请稍后......</span></div>

</body>

</html>
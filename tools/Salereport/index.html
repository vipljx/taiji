<!DOCTYPE html>
<html>

<head>
	<title></title>
	<meta charset="UTF-8">
	<!--<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />-->
	<link rel="stylesheet" type="text/css" href="../Css/bootstrap.css" />
	<link rel="stylesheet" type="text/css" href="../Css/bootstrap-responsive.css" />
	<link rel="stylesheet" type="text/css" href="../Css/style.css" />
	<script type="text/javascript" src="../Js/jquery.js"></script>
	<script type="text/javascript" src="../Js/jquery-ui.js"></script>
	<script type="text/javascript" src="../Js/bootstrap.js"></script>
	<script type="text/javascript" src="../Js/ckform.js"></script>
	<script type="text/javascript" src="../Js/common.js"></script>
	<script type="text/javascript" src="../Js/js/laydate.js"></script>
	<script type="text/javascript" src="../Js/ui.js"></script>
	<script type="text/javascript" src="../Js/ursl.js"></script>
	<script src="../Js/highcharts.js"></script>
	<script src="../Js/exporting.js"></script>
	<script src="../Js/series-label.js"></script>
	<script src="../Js/oldie.js"></script>
	<script src="../Js/highcharts-zh_CN.js"></script>
	<style type="text/css">
		body {
			padding-bottom: 40px;
		}

		.sidebar-nav {
			padding: 9px 0;
		}

		@media (max-width: 980px) {
			/* Enable use of floated navbar text */
			.navbar-text.pull-right {
				float: none;
				padding-left: 5px;
				padding-right: 5px;
			}
		}

		.lbs {
			margin-top: 20px;
			margin-left: 20px;
		}

		#test {
			width: 100%;
			height: 100%;
			background-color: #000;
			position: absolute;
			top: 0;
			left: 0;
			z-index: 2;
			opacity: 0.3;
			/*兼容IE8及以下版本浏览器*/
			filter: alpha(opacity=30);
			display: none;
		}

		#log_window {
			width: 800px;
			height: 580px;
			/*overflow: scroll;*/
			padding-bottom: 50px;
			background-color: white;
			margin: auto;
			position: absolute;
			z-index: 3;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			display: none;
			overflow-y:scroll;
		}

		.theadColor th {
			background-color: #b1d6e8;
			/*color: #1976b0;*/
			font-weight: normal;
		}

		.theadColor th span {
			color: #1976b0;
		}

		#chaxun {
			margin-top: 10px;
		}

		#addnew1 {
			margin-top: 10px;
		}

		#rolename {
			margin-top: 19px;
		}

		.theadColor td,
		.tableleft {
			/*background-color: #b1d6e8;*/
			/*color: #1976b0;*/
			font-weight: normal;
		}

		.theadColor td,.tableleft  span {
			color:#000;
			font-weight: bold;
		}

		#rolename {
			padding-right: 26px;
			background: url("../assets/img/fangdajing.png") no-repeat scroll right center transparent;
		}

		#log_window2 {
			width: 300px;
			height: 200px;
			min-height: 100px;
			background-color: white;
			border: 1px solid gainsboro;
			margin: auto;
			position: absolute;
			z-index: 4;
			padding-bottom: 20px;
			top: 57%;
			right: 38%;
			display: none;
		}

		.error {
			font-size: 12px;
			color: red;
			text-align: left;
			padding-left: 30px;
		}

		.ok {
			font-size: 12px;
			text-align: left;
			padding-left: 30px;
		}
		#userlist,#userlist1{
			position: absolute;
			width:40%;
			border: 1px solid #dedede;
			background: #ffffff;
			border-top: none;
			margin: 0;
			text-align:left;
			display: none;

		}
		#userlist li{
			list-style: none;
			line-height: 25px;
		}
		#userlist li div{
			color: black;
		}
		#userlist li:hover{
			background: #F6F6F6;
		}
		.onclick{
			margin-left: 35px;
		}
		.onclick a{
			margin: 0;

		}
	</style>

	<script>
        var page = 1;
        var count = 10;
        var maxpage = 0;
        var dataarr = [];
        var currentIndex = -1;
        var localhost = " ";
        var arrMarkid = [];
        var manager, mgrid;
        var fields = [];
        var addable1, updateable1, delable1, authority, pms;
        var temp = [];
        var cardState;
        localhost = window.sessionStorage ? sessionStorage.getItem("lh") : Cookie.read("lh");
        //			var url1="192.168.1.248";
        var url1 =urls;
        //加载列表
        function init() {
            localhost = window.sessionStorage ? sessionStorage.getItem("lh") : Cookie.read("lh");
            table =14;
            var uname = window.sessionStorage ? sessionStorage.getItem("mgr") : Cookie.read("mgr");
            manager = jQuery.parseJSON(uname);
            mid = manager.mid;
            mgrid = manager.id;
            role = manager.type;
            pms = window.sessionStorage ? sessionStorage.getItem("管 理 员") : Cookie.read("管 理 员");
            authority = jQuery.parseJSON(pms);
            addable1 = authority.addable;
            updateable1 = authority.updateable;
            delable1 = authority.delable;
            if (null == uname || undefined == uname) {
                parent.window.location = '../Public/login.html';
                return;
            }
            var currentPage = window.sessionStorage ? sessionStorage.getItem("currentPageshop") : Cookie.read("currentPageshop");
            if (null != currentPage && undefined != currentPage && currentPage.length > 0) {
                window.location = currentPage;
            }
            if (window.sessionStorage) {
                page = sessionStorage.getItem("shop_page");
            } else {
                page = Cookie.read("shop_page");
            }
            if (null == page)
                page = 1;
            document.getElementById('pagelab').value = page;
            var Sys = {};
            var ua = navigator.userAgent.toLowerCase();
            var s;
            (s = ua.match(/msie ([\d.]+)/)) ? Sys.ie = s[1]:
                (s = ua.match(/firefox\/([\d.]+)/)) ? Sys.firefox = s[1] :
                    (s = ua.match(/chrome\/([\d.]+)/)) ? Sys.chrome = s[1] :
                        (s = ua.match(/opera.([\d.]+)/)) ? Sys.opera = s[1] :
                            (s = ua.match(/version\/([\d.]+).*safari/)) ? Sys.safari = s[1] : 0;
            if (Sys.ie) { //Js判断为IE浏览器
                alert('http://www.wangjinhai119.com' + Sys.ie);
                if (Sys.ie == '9.0') { //Js判断为IE 9
                } else if (Sys.ie == '8.0') { //Js判断为IE 8
                } else {}
            }
            if (Sys.firefox) { //Js判断为火狐(firefox)浏览器
                document.getElementById('pagelab').style.marginTop = '19px';
            }
            if (Sys.chrome) { //Js判断为谷歌chrome浏览器
                document.getElementById('pagelab').style.marginTop = '18px';
            }
            if (Sys.opera) { //Js判断为opera浏览器
                alert('http://www.wangjinhai119.com' + Sys.opera);
            }
            if (Sys.safari) { //Js判断为苹果safari浏览器
                document.getElementById('pagelab').style.marginTop = '9px';
            }
            initFields();
        }


        //		取数据
        function initTableData(){
            if(sessionStorage.getItem("cardState")!=null){
                cardState=sessionStorage.getItem("cardState");

            }
            var selectState = document.getElementById("selectState");
            for (var l = 0; l < selectState.options.length; l++) {
                var tmp = selectState.options[l].value;
                if (tmp == cardState) {
                    selectState.options[l].selected = 'selected';
                }
            }
//		    console.log(sessionStorage.getItem("cardState"))
            var obj=new Object();
            obj.type=1;
            obj.page=page;
            obj.count=count;
            obj.vid=manager.vid;
            if(cardState==null){
                obj.types=0;
            }else{
                obj.types=cardState;
            }

            var datajson=JSON.stringify(obj);
            //console.log(datajson);
            $.ajax({
                type: "post",
                contentType:"application/x-www-form-urlencoded",
                data:datajson,
                dataType:"json",
                url:"http://" + url1 + ":6078/getallshopinfobyvid",
                success: function(data) {
                    //console.log(data);
                    var table1 = document.getElementById('tbl');
                    dataarr = [];
                    while (table1.rows.length > 1) {
                        table1.deleteRow(1);
                    }
                    //console.log("此处是接口");
                    if(data.respVo.resultCode==0){
                        //设置排序
                        data.shopinfoMap.sort(function sortId(a,b){
                            return b.shopid-a.shopid
                        });
                        //console.log(data.shopinfoMap);

                        if (window.sessionStorage ) {
                            delUser = JSON.parse(sessionStorage.getItem("delUser")?sessionStorage.getItem("delUser"):"[]");
                            updateStudent1 = JSON.parse(sessionStorage.getItem("updateStudent1")?sessionStorage.getItem("updateStudent1"):"[]");
                        } else {
                            delUser = JSON.parse(Cookie.read("delUser")?sessionStorage.getItem("delUser"):"[]");
                            updateStudent1 = JSON.parse(Cookie.read("updateStudent1")?sessionStorage.getItem("updateStudent1"):"[]");
                        }
                        //console.log(data.shopinfoMap);
                        for (var i = 0; i < data.shopinfoMap.length; i++) {
                            if(updateStudent1.length>0) {
                                for (var j = 0; j < updateStudent1.length; j++) {
                                    if (data.shopinfoMap[i].id == updateStudent1[j].id) {
                                        data.shopinfoMap[i] = updateStudent1[j];
                                    }
                                }
                            }
                            dataarr.push(data.shopinfoMap[i]);
                            if(delUser.indexOf(data.shopinfoMap[i].id)==-1){
                                var row = table1.insertRow(table1.rows.length);
                                for (var k = 0; k < nowfields.length; k++) {

                                    var cell = row.insertCell(k);
                                    cell.innerHTML = nowfields[k].fieldname=="role"?data.shopinfoMap[i]["rolename"]: nowfields[k].fieldname=="vid"?data.shopinfoMap[i]["venuename"]?data.shopinfoMap[i]["venuename"]:"暂无所属拳馆":dataarr[i][nowfields[k].fieldname];



                                }
                                var optcell = row.insertCell(fields.length);
                                optcell.innerHTML = "<input type='image' src='../assets/img/chakan.png' id='xiangqing" + i + "' onclick='report(" + i + ")'>";
                            }
                        }
                        maxpage = Math.ceil(data.respVo.resultDesc / count);
                        //console.log(maxpage);
                        document.getElementById('pagelab').value = page;
                        //设置分页
                        var first=$(".page>div>div:nth-child(1)");
                        var prev=$(".page>div>div:nth-child(2)");
                        var next=$(".page>div>div:nth-child(3)");
                        var last=$(".page>div>div:nth-child(4)");

                        if(page>1){
                            first.attr("class","blue")
                        }else{
                            first.attr("class","gray")
                        }
                        if(page>1){
                            prev.attr("class","blue")
                        }else{
                            prev.attr("class","gray")
                        }
                        if(page<maxpage){
                            //console.log(next);
                            next.attr("class","blue")
                        }else{
                            next.attr("class","gray")
                        }
                        if(page<maxpage){
                            last.attr("class","blue")
                        }else{
                            last.attr("class","gray")
                        }
                    }else{
//						    alert(data.respVo.resultDesc);
                    }
                    initMakeidSelect();
                },
                error: function(err) {
//						alert("err:" + err);
                }
            });


        }
        function changeState(){
            cardState=document.getElementById("selectState").value;
            sessionStorage.setItem("cardState",cardState);
            init();

        }
        //动态表头
        function initFields() {
            var users=new Object();
            users.rid=role;
            users.smid=14;
            var datajson=JSON.stringify(users);
            $.ajax({
                type: "post",
                contentType:"application/x-www-form-urlencoded",
                data:datajson,
                dataType:"json",
                url:"http://" + url1 + ":6078/backstagegetpermissionfieldbyridsmid",
                success: function(data) {
                    data.permissionfieldmap.sort(function(a,b){
                        return a.smdid-b.smdid;
                    });
                    fields = [];
                    nowfields = [];
                    //console.log(data.permissionfieldmap);
                    for (var i = 0; i < data.permissionfieldmap.length; i++) {
                        var fieldname=data.permissionfieldmap[i].fieldname;
                        if(fieldname=="name"){
                            data.permissionfieldmap[i].name="学号";
                        }
                        if(fieldname!=="enable" && fieldname!=="password" && fieldname!=="level"){
                            fields.push(data.permissionfieldmap[i]);
                        }
                        //console.log(data.permissionfieldmap[i]);
                        if(fieldname=="exchange_num" ){
                            data.permissionfieldmap[i].fieldname="counts";
                            data.permissionfieldmap[i].name="销量";
                            nowfields.push(data.permissionfieldmap[i]);
                        }else{
                            nowfields.push(data.permissionfieldmap[i]);
						}
                    }
                    var th = document.getElementById("tabhead");
                    while (th.cells.length > 0) {
                        th.deleteCell(0);
                    }
                    for (var i = 0; i < nowfields.length; i++) {
                        var headcell = th.insertCell(i);
                        headcell.innerHTML = "<th><span>" + nowfields[i].name + "</span></th>";
                    }
                    var headoptcell = th.insertCell(nowfields.length);
                    headoptcell.innerHTML = "<th><span>" + "操 作" + "</span></th>";

                    initTableData();
                },
                error: function(err) {
                    //						alert("err:" + err);
                }
            });
        }
        //获取拳馆信息
        function initMakeidSelect() {
            var obj=new Object();
            obj.vid=manager.vid;
            obj.page=page;
            obj.count=count;
            var datajson=JSON.stringify(obj);
            $.ajax({
                type: "post",
                contentType:"application/x-www-form-urlencoded",
                data:datajson,
                dataType:"json",
                url:"http://" + url1 + ":6078/backstagegetvenue",
                success: function(data) {
//						var res = jQuery.parseJSON(data.VenueMap);
                    arrMarkid = [];
                    for (var i = 0; i < data.VenueMap.length; i++) {
                        arrMarkid.push(data.VenueMap[i]);
                    }
                   // console.log(arrMarkid)
                },
                error: function(err) {
                    alert("失败")
                    //						alert("err:" + err);
                }
            })
        }



        function first(){
            if(document.getElementById("pagelab").value==1){
                mizhu.alert('','当前已经为第一页!','iconfont-close');
            }
            else{
                initTable(1,true);
            }

        }
        function last(){

            if(document.getElementById("pagelab").value==maxpage){
                mizhu.alert('','当前已经为最后页!','iconfont-close');
            }
            else{
                initTable(parseInt(maxpage),true);
            }

        }


        //分页
        function initTable(step, flag = false) {
//				initFields();
            step = parseInt(step);
            var p = parseInt(page) + parseInt(step);
            if (flag) {
                if (step < 1 || step > maxpage) {
                    mizhu.alert('','页码超标','iconfont-close');
                    return;
                }
                page = step;
            } else {
                page = p;
                if (page < 1 || page > maxpage) {
                    page -= step;
                    return;
                }
            }

            var obj=new Object();
            obj.type=1;
            obj.page=page;
            obj.count=count;
            obj.vid=manager.vid;
            if(cardState==null){
                obj.types=0;
            }else{
                obj.types=cardState;
            }
            var datajson=JSON.stringify(obj);
            //console.log(datajson);
            $.ajax({
                type: "post",
                contentType:"application/x-www-form-urlencoded",
                data:datajson,
                dataType:"json",
                url:"http://" + url1 + ":6078/getallshopinfobyvid",
                success: function(data) {
                    //console.log(data);
                    //console.log("此处是接口");
                    if(data.respVo.resultCode==0){
                        //设置排序
                        data.shopinfoMap.sort(function sortId(a,b){
                            return b.shopid-a.shopid
                        });
                        //var res = jQuery.parseJSON(data);
                        var table1 = document.getElementById('tbl');
                        dataarr = [];
                        while (table1.rows.length > 1) {
                            table1.deleteRow(1);
                        }
                        if (window.sessionStorage ) {
                            delUser = JSON.parse(sessionStorage.getItem("delUser")?sessionStorage.getItem("delUser"):"[]");
                            updateStudent1 = JSON.parse(sessionStorage.getItem("updateStudent1")?sessionStorage.getItem("updateStudent1"):"[]");
                        } else {
                            delUser = JSON.parse(Cookie.read("delUser")?sessionStorage.getItem("delUser"):"[]");
                            updateStudent1 = JSON.parse(Cookie.read("updateStudent1")?sessionStorage.getItem("updateStudent1"):"[]");
                        }
                        //console.log(data.shopinfoMap);
                        for (var i = 0; i < data.shopinfoMap.length; i++) {
                            if(updateStudent1.length>0) {
                                for (var j = 0; j < updateStudent1.length; j++) {
                                    if (data.shopinfoMap[i].id == updateStudent1[j].id) {
                                        data.shopinfoMap[i] = updateStudent1[j];
                                    }
                                }
                            }
                            dataarr.push(data.shopinfoMap[i]);
                            if(delUser.indexOf(data.shopinfoMap[i].id)==-1){
                                var row = table1.insertRow(table1.rows.length);
                                for (var k = 0; k < nowfields.length; k++) {
                                    var cell = row.insertCell(k);
                                    cell.innerHTML = nowfields[k].fieldname=="role"?data.shopinfoMap[i]["rolename"]: nowfields[k].fieldname=="vid"?data.shopinfoMap[i]["venuename"]?data.shopinfoMap[i]["venuename"]:"暂无所属拳馆":dataarr[i][nowfields[k].fieldname];

                                }
                                var optcell = row.insertCell(nowfields.length);


                                var optcell = row.insertCell(fields.length);
                                optcell.innerHTML = "<input type='image' src='../assets/img/chakan.png' id='xiangqing" + i + "' onclick='report(" + i + ")'>";
                            }
                        }
                        maxpage = Math.ceil(data.respVo.resultDesc / count);
                        document.getElementById('pagelab').value = page;
                        //设置分页
                        var first=$(".page>div>div:nth-child(1)");
                        var prev=$(".page>div>div:nth-child(2)");
                        var next=$(".page>div>div:nth-child(3)");
                        var last=$(".page>div>div:nth-child(4)");
                        if(page>1){
                            first.attr("class","blue")
                        }else{
                            first.attr("class","gray")
                        }
                        if(page>1){
                            prev.attr("class","blue")
                        }else{
                            prev.attr("class","gray")
                        }
                        if(page<maxpage){
                            next.attr("class","blue")
                        }else{
                            next.attr("class","gray")
                        }
                        if(page<maxpage){
                            last.attr("class","blue")
                        }else{
                            last.attr("class","gray")
                        }
                    }else{
                        alert(data.respVo.resultDesc);
                    }
                },
                error: function(err) {
//						alert("err:" + err);
                }
            });


        }

        function pageKeyUpHandler(evt) {
            if (evt.keyCode == 13) {
                initTable(parseInt(document.getElementById("pagelab").value), true);
            }
        }

        //查询
        function inquiry() {
            //				initFields();
            page = 1;
            document.getElementById('pagelab').value = page;
            if (window.sessionStorage) {
                sessionStorage.setItem("shop_page", page);
            } else {
                Cookie.write("shop_page", page);
            }
            $.ajax({
                type: "get",
                contentType: "application/xml",
                url: "http://" + localhost + ":8080/fkds1.5.tools/shopinfo/getShopInfoByName.action?shop_name=" + document.getElementById('rolename').value + "&page=1&count=10",
                success: function(data) {
                    res = jQuery.parseJSON(data);
                    var table1 = document.getElementById('tbl');
                    dataarr = [];
                    while (table1.rows.length > 1) {
                        table1.deleteRow(1);
                    }
                    var delid = -1;
                    var delurl = "";
                    if (window.sessionStorage) {
                        delid = sessionStorage.getItem("deleteId");
                        delurl = sessionStorage.getItem("delurl");
                    } else {
                        delid = Cookie.read("deleteId");
                        delurl = Cookie.read("delurl");
                    }
                    for (var i = 0; i < res.res.length; i++) {
                        dataarr.push(res.res[i]);
                        var row = table1.insertRow(table1.rows.length);
                        for (var k = 0; k < fields.length; k++) {
                            var cell = row.insertCell(k);
                            cell.innerHTML = res.res[i][fields[k].fieldname];
                            if(fields[k].fieldname=="image_name"){

                                cell.innerHTML='<img src="'+"http://120.77.34.195:8080/fkds1.5.tools/upload"+res.res[i].image_name+'">'
                            }
                        }
                        //操作
                        var optcell = row.insertCell(fields.length);
                        if (res.res[i].state == 0) {
                            optcell.innerHTML = '审核中......';
                        } else if (res.res[i].state == 1) {
                            optcell.innerHTML = "<input type='image' src='../assets/img/bianji.png' id='bianji" + i + "' onmousemove='isdisadd(this)' onmouseout='isdisout(this)' onclick='edit(" + res.res[i].shopid + ")'>" +
//									"&nbsp;&nbsp;&nbsp;<input type='image' src='../assets/img/mubiao.png' onclick='shuxing(" + res.res[i].shopid + ")'>" +
                                "&nbsp;&nbsp;&nbsp;<input type='image' src='../assets/img/shanchu.png' id='shanchu" + i + "' onmousemove='isdisadd(this)' onmouseout='isdisout(this)' onclick='del(" + res.res[i].shopid + "," + table1.rows.length + ")'>";
                        } else if (res.res[i].state == -1) {
                            optcell.innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;审核未通过......&nbsp;&nbsp;<input type='image' id='shanchu" + i + "' src='../assets/img/shanchu.png' onmousemove='isdisadd(this)' onmouseout='isdisout(this)' onclick='del(" + res.res[i].id + "," + table1.rows.length + ")'>";
                        }
                        if (res.res[i].id + "" == delid + "") {
                            optcell.innerHTML = '已删除同步中...';
                        }
                    }
                },
                error: function(err) {
                    //						alert("err:" + err);
                }
            });
        }
        //编辑
        function edit(idx,id) {

//				document.getElementById("tupian").style.display="block";
//	        	document.getElementById("tupian1").style.display="none";
            if(dataarr[idx].itemtype=="2"){
                document.getElementById('sijiao').style.display="";
                document.getElementById('exnum').style.display="";
                document.getElementById('time').style.display="none";

            }
            else if(dataarr[idx].itemtype=="3"){
                document.getElementById('time').style.display="";
                document.getElementById('exnum').style.display="none";
                document.getElementById('sijiao').style.display="none";
                document.getElementById('exnum').style.display="none";
            }
            else{
                document.getElementById('time').style.display="none";
                document.getElementById('sijiao').style.display="none";
            }
            if (updateable1 == 0) {
                return;
            }
            var s = document.getElementById("test");
            s.style.display = "block";
            var l = document.getElementById("log_window");
            l.style.display = "block";
            var select2 = document.getElementById("markidSelect");
            var cbidx = dataarr[idx].marketid;
            while (select2.options.length > 0) {
                select2.remove(0);
            }
            for (var i = 0; i < arrMarkid.length; i++) {
                select2.options.add(new Option(arrMarkid[i].id + "、" + arrMarkid[i].name));
                if (cbidx == arrMarkid[i].id) {
                    select2.selectedIndex = i;
                }
            }
            var item = dataarr[idx].itemtype;
            var temptypes = item.split(",");

//				var goods = document.getElementsByName("goods");
//				goods[0].checked = false;
//				goods[1].checked = false;
//				goods[2].checked = false;
//				if(temptypes.indexOf("1") == -1){
//					goods[0].checked = true;
//					document.getElementById("koubei").disabled="disabled";
//				}
//				if(temptypes.indexOf("2") == -1){
//					goods[1].checked = true;
//					document.getElementById("koubei").disabled="";
//				}
//				if(temptypes.indexOf("3") == -1){
//					goods[2].checked = true;
//					document.getElementById("koubei").disabled="disabled";
//				}
//				$('input[type=radio][name=goods]').change(function() {
//			        if (this.value == '2') {
//			           document.getElementById("koubei").disabled="";
//			        }
//			        else{
//			            document.getElementById("koubei").disabled="disabled";
//			        }
//			    });
//				isenable();
            currentIndex = id;
            getObj('shopidtxt').value = dataarr[idx].shopid;
            getObj('mainInfo_texttxt').value = dataarr[idx].mainInfo_text;
            getObj('shop_nametxt').value = dataarr[idx].itemtype;
            getObj('itemin').value = dataarr[idx].iteminfo;
            getObj('shop_texttxt').value = dataarr[idx].shop_text;
            getObj('exchange_numtxt').value = dataarr[idx].exchange_num;
            getObj('pricetxt').value = dataarr[idx].price;
            getObj('exnuminfo').value = dataarr[idx].gamepoint;
//				getObj('start_timetxt').value = dataarr[idx].start_time;
//				getObj('end_timetxt').value = dataarr[idx].end_time;
//				getObj('note1_texttxt').value = dataarr[idx].note1_text;
//				getObj('diamondtxt').value = dataarr[idx].diamond;
//				getObj('timestamptxt').value = dataarr[idx].timestamp;
//				getObj('image_urltxt').value = dataarr[idx].image_url;
//				getObj('tupiantxt').value = dataarr[idx].image_name;
            //            getObj('image_nametxt').value = dataarr[idx].image_name;
//				pathName = dataarr[idx].image_name;
        }
        //判断是否可以修改
        function isenable() {
            $.ajax({
                type: "get",
                url: "http://" + localhost + ":8080/fkds1.5.tools/permission/getPermissionFieldByRid.action?rid=1",
                contentType: "application/xml",
                success: function(data) {
                    res = jQuery.parseJSON(data);
                    temp = [];
                    for (var i = 0; i < res.res.length; i++) {
                        temp.push(res.res[i]);
                    }
                    for (var i = 0; i < temp.length; i++) {
                        if ("图 片 路 径" == temp[i].name && 23 == temp[i].smdid) {
                            isindex = i;
                        }
                    }
                    if (1 == temp[isindex].enable) {
                        return getObj('image_urltxt').disabled = 'disabled';
                    } else if (0 == temp[isindex].enable) {
                        return getObj('image_urltxt').disabled = '';
                    }
                }
            });
        }

        function getObj(objid) {
            return document.getElementById(objid);
        }
        //关闭弹出的div
        function cancel_shield() {
            var s = document.getElementById("test");
            s.style.display = "none";
            var l = document.getElementById("log_window");
            l.style.display = "none";
            var l2 = document.getElementById("log_window2");
            l2.style.display = "none";
            var objToolTip = document.getElementById("mytooltip");
            objToolTip.innerText = "";
        }


        //权限增删改
        function isdisadd(obj) {
            var idstr = obj.id;
            if (addable1 == 0 && idstr.indexOf("add") >= 0) {
                document.getElementById(idstr).disabled = 'disabled';
                document.getElementById(idstr).style.cursor = "not-allowed";
            }
            if (updateable1 == 0 && idstr.indexOf("bian") >= 0) {
                document.getElementById(idstr).disabled = 'disabled';
                document.getElementById(idstr).style.cursor = "not-allowed";
            }
            if (delable1 == 0 && idstr.indexOf("shan") >= 0) {
                document.getElementById(idstr).disabled = 'disabled';
                document.getElementById(idstr).style.cursor = "not-allowed";
            }
        }

        function isdisout(obj) {
            var idstr = obj.id;
            document.getElementById(idstr).disabled = false;
            document.getElementById(idstr).style.cursor = "pointer";
        }

        //查看报表
        function report(idx,startime){
            //console.log(dataarr);
            if (window.sessionStorage) {
                sessionStorage.setItem("idx", idx);
                sessionStorage.setItem("shopid", dataarr[idx].shopid);
                sessionStorage.setItem("name", dataarr[idx].mainInfo_text);
            } else {
                Cookie.write("idx",idx);
                Cookie.write("shopid",dataarr[idx].id);
                Cookie.write("name",dataarr[idx].name);
            }
            if(!startime){
                var today = new Date();
                startime=today.getFullYear();
            }
            var obj=new Object();
            obj.shopid=window.sessionStorage? sessionStorage.getItem("shopid"): Cookie.read("shopid");
            obj.date=startime;
            var datajson=JSON.stringify(obj);
            //console.log(datajson);
            $.ajax({
                type: "post",
                contentType:"application/x-www-form-urlencoded",
                data:datajson,
                dataType:"json",
                url:"http://" + url1 + ":6078/backstagegetshopreport",
                success: function (res) {
                    console.log(res);
                    var arr=res.respVo.resultDesc.split(",");
                    var result=new Array();
                    for(var tmp of arr){
                        result.push(Number(tmp));
                    }
                    $("#highcharts").show();
                    hcharts(window.sessionStorage? sessionStorage.getItem("name"): Cookie.read("name"),startime,result);
                },
                error: function (err) {
                    //alert("err:" + err);
                }
            });
        }
        //折线图
        function hcharts(name,startime,result){
            var chart = Highcharts.chart('container', {
                chart: {
                    type: 'line'
                },
                title: {
                    text: startime+'年'+name+'商品消费统计'
                },
                xAxis: {
                    categories: ['一月', '二月', '三月', '四月', '五月', '六月', '七月', '八月', '九月', '十月', '十一月', '十二月']
                },
                yAxis: {
                    title: {
                        text: '销量'
                    }
                },

                plotOptions: {
                    line: {
                        dataLabels: {
                            // 开启数据标签
                            enabled: true
                        },
                        // 关闭鼠标跟踪，对应的提示框、点击事件会失效
                        enableMouseTracking: false
                    }

                },
                series: [{
                    name: '商品消费统计',
                    data:  result
                }]
            });
        }

        function inquiry(){
            var idx=window.sessionStorage? sessionStorage.getItem("idx"): Cookie.read("idx");
            var startime=document.getElementById("star").value;
            report(idx,startime)
        }

	</script>

</head>

<body onload="init()">
<div id="highcharts" style="display: none">
	<table align="center">
		<tr>
			<td><input id="star" type="text" style="width: 150px;height:25px;border-radius: 0px; position: relative; top: 5px;" ></td>
			<td><a onclick="inquiry()" class="sousuo">搜索</a></td>
		</tr>
	</table>
	<script>
		var s=new Date().getFullYear();
		$("#star").val(s);
		laydate.render({
			elem: '#star'
			,type: 'year'
		});
	</script>
	<div id="container" style="max-width:800px;height:400px; margin: 0 auto;"></div>
</div>

<div class="onclick">
	<select name="" id="selectState" style="height:35px;margin-top:20px" onchange="changeState()">
		<option value="0">全部</option>
		<option value="1">商品</option>
		<option value="2">私教卡</option>
		<option value="3">时间卡</option>
	</select>
</div>
<table class="table table-hover definewidth m10" id="tbl">
	<thead id="thead">
	<tr id="tabhead" class="theadColor">
	</tr>
	</thead>
</table>

<div class="inline pull-right page">
	<div class="first" onclick="first()">第一页</div>
	<div class="prev" onclick="initTable(-1)">上一页</div>
	<div class="next" onclick="initTable(1)">下一页</div>
	<div class="last" onclick="last()">最后一页</div>
	<div class="clearfix"></div>
	<input type="hidden" id="pagelab" style="width: 50px;height:22px;overflow:hidden;margin-right: 5px;text-align: center;border-radius: 0px" onkeyup="pageKeyUpHandler(event)">
</div>

<!--//弹出遮罩-->
<div id="test"></div>
<div id="log_window">
	<input type="image" src='../assets/img/guanbi.png' onclick="cancel_shield()" style="position: fixed;margin-left: 745px;margin-top: 10px;">
	<table class="table table-bordered " style="width:600px;margin:0 auto;margin-top: 50px">
		<tr>
			<td class="tableleft"><span class="tanKuang">拳馆</span></td>
			<td style="padding-top:15px"><select id="markidSelect" style="border-radius: 0px;width: 95%"></select></td>
		</tr>
		<!--<tr>
            <td class="tableleft"><span class="tanKuang">商 品 类 型</span></td>
            <td style="padding-top: 18px;text-align:left;padding-left: 20px;" id="shop_type">
                <input type="radio" name="goods" value="1" />商店商品（商品只会出现在商店中）<br/>
                <input type="radio" name="goods" value="2" />口碑商品（商品只会出现在活动奖励中）<input id="koubei" type="text" placeholder="请输入口碑卷" style="border-radius: 0px;" disabled/><br/>
                <input type="radio" name="goods" value="3" />宝箱商品（商品只会出现在宝箱中）
            </td>
        </tr>-->
		<tr>
			<td class="tableleft"><span class="tanKuang">物 品 名 称</span></td>
			<td style="padding-top:15px"><input type="text" id="mainInfo_texttxt" name="moduletitle" style="border-radius: 0px;width: 95%" oninput="checkgoodname()" onblur="checkgoodname()" onfocus="showmiss1()" placeholder="(名称最多100个字符，包含字母、数字、中文和英文符号)" />
				<br /><span id="mainInfo_texttxtinfo" class="missspan" style="display: none;">名称最多100个字符，包含字母、数字、中文和英文符号</span></td>
		</tr>
		<tr>
			<td class="tableleft"><span class="tanKuang">物 品 类 型</span></td>
			<td style="padding-top:15px">
				<select name="" id="shop_nametxt"  style="border-radius:0px;width:95%;" onchange="selectcard()">
					<option value="1" selected="selected">商品</option>
					<option value="2">私教卡</option>
					<option value="3">时间卡</option>
					<!--<option value="折扣卷">折扣卷</option>
                    <option value="实物劵">实物劵</option>-->
				</select>
			</td>
		</tr>
		<tr style="display:none;" id="sijiao">
			<td class="tableleft"><span class="tanKuang">私教</span></td>
			<td style="padding-top:15px">
				<select name="" id="iteminfo"  style="border-radius:0px;width:95%;">
					<!--<option value="1" selected="selected">普通商品</option>
                    <option value="2">私教卡</option>
                    <option value="3">时间卡</option>
                    <!--<option value="折扣卷">折扣卷</option>-->
					<!--<option value="实物劵">实物劵</option>-->-->
				</select>
			</td>
		</tr>

		<tr style="display:none;" id="exnum">
			<td class="tableleft"><span class="tanKuang">次数</span></td>
			<td style="padding-top:15px">
				<input type="text"  id="exnuminfo" name="moduletitle" style="border-radius: 0px;width: 95%"/>
			</td>
		</tr>
		<tr style="display:none;" id="time">
			<td class="tableleft"><span class="tanKuang">时间</span></td>
			<td style="padding-top:15px">
				<input type="text"  id="itemin" name="moduletitle" style="border-radius: 0px;width: 95%"/>
			</td>
		</tr>

		<tr>
			<td class="tableleft"><span class="tanKuang">描 述</span></td>
			<td style="padding-top:15px"><input type="text" id="shop_texttxt" name="moduletitle" style="border-radius: 0px;width: 95%" oninput="checkdescription()" onblur="checkdescription()" onfocus="showmiss3()" placeholder="(描述包含字母、数字、中文和英文符号,字数不限)" />
				<br /><span id="shop_texttxtinfo" class="missspan" style="display: none;">描述包含字母、数字、中文和英文符号,字数不限</span></td>
		</tr>
		<tr>
			<td class="tableleft"><span class="tanKuang">物 品 数 量</span></td>
			<td style="padding-top:15px"><input type="text" id="exchange_numtxt" name="grouptitle" style="border-radius: 0px;width: 95%" oninput="checknum()" onblur="checknum()" onfocus="showmiss4()" placeholder="(物品数量只能为数字)" />
				<br /><span id="exchange_numtxtinfo" class="missspan" style="display: none;">物品数量只能为数字</span></td>
		</tr>
		<tr>
			<td class="tableleft"><span class="tanKuang">物 品 价 格</span></td>
			<td style="padding-top:15px"><input type="text" id="pricetxt" name="moduletitle" style="border-radius: 0px;width: 95%" oninput="checkprice()" onblur="checkprice()" onfocus="showmiss5()" placeholder="(价格只能为数字)" />
				<br /><span id="pricetxtinfo" class="missspan" style="display: none;">价格只能为数字</span></td>
		</tr>
		<!--<tr>
            <td class="tableleft"><span class="tanKuang">开 始 时 间</span></td>
            <td style="padding-top: 18px">
                <input type="text" id="start_timetxt" name="moduletitle" style="border-radius: 0px;width: 95%" placeholder="请选择开始时间" oninput="checkstarttime()" onpropertychange="checkstarttime()" onClick="laydate({elem: '#start_timetxt',istime: true, format: 'YYYY-MM-DD hh:mm:ss'})"
                /><br /><span id="start_timetxtinfo"></span>

            </td>
        </tr>
        <tr>
            <td class="tableleft"><span class="tanKuang">结 束 时 间</span></td>
            <td style="padding-top: 18px">
                <input type="text" id="end_timetxt" name="moduletitle" style="border-radius: 0px;width: 95%" placeholder="请选择结束时间" oninput="checkendtime()" onClick="laydate({elem: '#end_timetxt',istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" /><br /><span id="end_timetxtinfo"></span>

            </td>
        </tr>-->
		<!--<tr>
            <td class="tableleft"><span class="tanKuang">商 品 图</span></td>

            <td id="tupian" style="padding-top: 18px;display: none;">
                <input type="text" id="tupiantxt" style="width: 70%;border-radius: 0px;" disabled="disabled"/><button style="width: 25%;height: 25px;margin-top: -10px;" onclick="reload1()">重新上传</button>
            </td>


            <td style="padding-top: 18px" id="tupian1"><input type="file" id="image_nametxt" accept="image/png,image/gif,application/msword"   name="moduletitle" style="border-radius: 0px" style="width:20px;height:30px;" />
                <input type="button" value="上传" onclick="upload()">

            </td>
        </tr>-->
		<!--<tr style="display: none;">
            <td class="tableleft"><span class="tanKuang">图 片 路 径</span></td>
            <td style="padding-top: 18px"><input type="text" id="image_urltxt" name="moduletitle" style="border-radius: 0px;width: 95%" oninput="checkimgurl()" onblur="checkimgurl()" onfocus="showmiss7()" placeholder="(图片路径不能为空)" />
                <br /><span id="image_urltxtinfo" class="missspan" style="display: none;">图片路径不能为空</span></td>
        </tr>-->
		<!--<tr>
            <td class="tableleft"><span class="tanKuang">物 品 等 级</span></td>
            <td style="padding-top: 18px"><select name="" id="note1_texttxt"  style="border-radius: 0px;width: 95%">
                <option value="1" selected="selected">1 初级物品</option>
                <option value="2">2 中级物品</option>
                <option value="3">3 高级物品</option>
            </select>
                <br /><span id="note1_texttxtinfo" class="missspan" style="display:none;">预留只能为数字</span></td>
        </tr>-->


		<!--<tr>
            <td class="tableleft"><span class="tanKuang">审 核 人</span></td>
            <td style="padding-top: 18px">
                <input type="text" placeholder="请勾选审核人" id="auditortxt" style="border-radius: 0px;width: 95%" oninput="checkauditor()"  onclick="check()" onfocus="showmiss10()">
                <br /><span id="auditortxtinfo" class="missspan" style="display: none;">你必须选择一个审核人</span>

            </td>
        </tr>-->
		<tr>
			<td class="tableleft"></td>
			<td>
				<input id="saveallinfo" type="image" src='../assets/img/save.png'   onclick="onSavebtnClickHandler()" />
			</td>
		</tr>
	</table>
	<!--<div id="showdiv" style="width: 100%; height: 100%; position: absolute; top:0;left:0; background: none; ">
       <div style="width: 64px; position: fixed; height:64px; left:50%; top:50%;margin-top:-32px;margin-left: -32px;"><image src="../Images/5.gif" style="width: 64px;height: 64px"/></div>
   </div>-->
	<input type="hidden" id="shopidtxt" name="grouptitle" style="border-radius: 0px;width: 95%" />
</div>
<div id="mytooltip"></div>

<!--审核人-->
<div id="log_window2" style="display: none;">
	<a href="javascript:cancel_shield2()" style="position: absolute;left: 260px;margin-top: -5px;">关闭</a>
	<div style="width: 200px;margin:0 auto;height: 150px;overflow: scroll;" id="divv">
		<p id="pp" style="height: 100%;width: 100%;"></p>
	</div>
	<div style="margin-top: 20px">
		<button style="margin-left: 70px" onclick="confimbtn()">确定</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
		<button onclick="quxiaobtn()">取消</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	</div>
</div>
</body>

</html>
